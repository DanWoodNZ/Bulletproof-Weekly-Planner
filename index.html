<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> Glance: Manage your team </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="style/login-style.css">
</head>

<body>
    <div class="container-fluid login-page" id="background">
        <div class="row-fluid logo">
            <img class="logo-image" src="img/glance_logo_white_lg.png">
        </div>
        <div class="form">
            <div class="register-form">
                <input type="text" id='register-firstname-input' placeholder="first name" />
                <input type="text" id='register-lastname-input' placeholder="last name" />
                <input type="text" id='register-email-input' placeholder="email address" />
                <input type="password" id='register-password-input' placeholder="password" />
                <input type="password" id='register-repassword-input' placeholder="enter password again" />
                <button id='register-button'>Create</button>
                <p class="message">Already registered?
                    <a class="login-form-btn" href="#">Sign In</a>
                </p>
            </div>
            <div class="login-form">
                <input id='email-input' type="text" placeholder="email" />
                <input id='password-input' type="password" placeholder="password" />
                <button id='login-button'>Login</button>
                <p class="message">Not registered?
                    <a class="register-form-btn" href="#">Create an account</a>
                </p>
                <p class="message">Forgot password?
                    <a class="reset-form-btn" href="#">Reset password</a>
                </p>
            </div>
            <div class="reset-form">
                <input id='reset-email-input' type="text" placeholder="email" />
                <button id='reset-btn'>Reset password</button>
                <p class="message">Not registered?
                    <a class="register-form-btn" href="#">Create an account</a>
                </p>
                <p class="message">Remember your password?
                    <a class="login-form-btn" href="#">Sign In</a>
                </p>
            </div>
        </div>
    </div>
</body>

<script>
    $(document).ready(function () {
        //Listender attached to login button
        $("#login-button").click(function () {
            var email = "",
                password = "";
            email = $('#email-input').val();
            password = $('#password-input').val();

            $.post(
                'php/login.php',
                {
                    email: email,
                    password: password
                }, function (data) {
                    if (data == 'success') {
                        window.location.href = 'week-calendar.html';
                    } else {
                        alert(data);
                        $('#email-input').val("");
                        $('#password-input').val("");
                    }
                }
            )
        }
        );


        $('#register-button').click(function () {
            var firstName = "",
                lastName = "",
                password = "",
                rePassword = "";

            firstName = $('#register-firstname-input').val();
            lastName = $('#register-lastname-input').val();
            password = $('#register-password-input').val();
            rePassword = $('#register-repassword-input').val();
            email = $('#register-email-input').val();


            //Check all fields have been entered 
            if (!(firstName.length == 0 ||
                lastName.length == 0 ||
                password.length == 0 ||
                rePassword.length == 0 ||
                email.length == 0)) {

                //Check if email is valid
                if (isEmail(email)) {
                    //Check both passwords match
                    if (password === rePassword) {

                        $.post('php/register.php',
                            {
                                firstName: firstName,
                                lastName: lastName,
                                password: password,
                                email: email
                            }, function (data) {
                                alert(data);
                            }

                        )
                    } else {
                        alert("Passwords dont match");
                    }
                }
            } else {
                alert("Please enter all fields");
            }
        });



        function bindEvents() {
            $("#reset-btn").click(function () {
                resetPassword();
            });
        }

        bindEvents();

        function resetPassword() {
            var email = "";

            email = $("#reset-email-input").val();
            alert(email);
            if (isEmail(email)) {
                alert("Email adress is valid");
                resetPasswordDB(email).done(function (data) {
                    alert(data);
                })
            } else {
                alert("Please enter a valid email address");
            }
        }

        function resetPasswordDB(email) {
            return $.post("php/forgottenPassword.php", { email: email })
        }


        function bindLoginScreenNavigation() {
            $('.login-form-btn').click(function () {
                animateLoginFormTransition($(this).closest("div").add(".login-form"));
            })

            $('.reset-form-btn').click(function () {
                animateLoginFormTransition($(this).closest("div").add(".reset-form"));
            })

            $('.register-form-btn').click(function () {
                animateLoginFormTransition($(this).closest("div").add(".register-form"));
            })
        }

        bindLoginScreenNavigation();

        function animateLoginFormTransition($forms) {
            $forms.animate({ height: "toggle", opacity: "toggle" }, "slow");
        }


        function isEmail(email) {
            var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            return regex.test(email);
        }
    });
</script>

</html>